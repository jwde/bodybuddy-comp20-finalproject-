doctype
html
  head
    title BodyBuddy: Your Profile
    meta(charset='utf-8')
    link(rel='stylesheet', href='/css/profile.css')
  body
    .top Welcome Back!
    .top#date Today is #{date}
    mixin workoutListing(name, intensity, description)
      li #{name}: #{intensity}<br>#{description}
    .upper
      .left
        h2#inner Feedback 
        #feedback #{feedback}
        .buttongroup
          button(id="submit", onclick="complete()") I completed my workout!
          button(id="submit", onclick="uncomplete()") I had trouble completing my workout        
      #chart  
    .bottom#workouts
      h2#inner Your Next Workout
      ul#exercises
        for workout in workouts
          +workoutListing(workout.title, workout.intensity, workout.description)
    img(id="logo" src="/img/bblogo.png" alt="Body Buddy Logo")         
    script(type='text/javascript' src="https://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1','packages':['corechart']}]}")
    script.
      var historyLit = !{history};
      var historyArr = [];
      for (i = 0; i < historyLit.history.length; ++i) {
        historyArr[i] = [historyLit.history[i].time, historyLit.history[i].avg];
      }

      function complete() {
      var request = new XMLHttpRequest();

      request.open("POST","http://bodybuddy.herokuapp.com/profile",true);
        request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        request.onreadystatechange = function () {
            update(request);
        }
        request.send("success=yes");
      }

      function uncomplete() {

      var request = new XMLHttpRequest();

      request.open("POST","http://bodybuddy.herokuapp.com/profile",true);
        request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        request.onreadystatechange = function () {
            update(request);
        }
        request.send("success=no");
      }

      function update (request) {
        if (request.readyState == 4) {
          var info = JSON.parse(request.responseText);
          for (var exercise in info.workout) {
            document.getElementById('exercises').innerHTML = "<li>" + exercise.name + ": " + exercise.intensity + "<br>" + exercise.description + "</li>";
          }
        }
      }

      function renderChart() {
        var dataTable = new google.visualization.DataTable();
        dataTable.addColumn('number', 'Time');
        dataTable.addColumn('number', 'Progress');
        dataTable.addRows(historyArr);

        var dataView = new google.visualization.DataView(dataTable);
      
        var chart = new google.visualization.LineChart(document.getElementById('chart'));
        var options = {
           colors:['#428BCA'],
           width: 600, height: 340,
          //legend: 'none',
          pointSize: 3,
            hAxis:{
            title:'Time'
            },
            vAxis:{
            title:'Progress'
            }
        };
        chart.draw(dataView, options);
      }
      window.onload = renderChart;
